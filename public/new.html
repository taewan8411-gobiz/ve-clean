<!doctype html>
<html lang="ko"><meta charset="utf-8" />
<title>새 문의 작성</title>
<link rel="stylesheet" href="/style.css" />
<body>
<header>
  <div class="container row">
    <h2>온라인수출 애로해소 게시판</h2>
    <nav class="nav right">
      <a href="/index.html" data-nav="home">홈</a>
      <a href="/new.html" data-nav="new">질문하기</a>
      <a href="/index.html" data-nav="answers">답변보기</a>
    </nav>
  </div>
</header>

<div class="container">
  <div class="card">
    <label>분야</label>
    <select id="category">
      <option>글로벌셀링</option>
      <option>수출신고</option>
      <option>물류통관</option>
      <option>세무회계</option>
      <option>바이어발굴</option>
      <option>규격인증</option>
      <option selected>기타</option>
    </select>

    <label>제목</label>
    <input id="title" placeholder="제목을 입력하세요" />

    <label>내용</label>
    <textarea id="content" rows="10" placeholder="상세 문의 내용을 적어주세요."></textarea>

    <div class="row" style="margin-top:12px">
      <button id="submit" class="primary">등록</button>
      <div id="loading" class="center" style="display:none"><div class="spinner"></div></div>
    </div>
  </div>
</div>

<script>
  // 메뉴 하이라이트
  (function(){ const el=document.querySelector('.nav a[data-nav="new"]'); if(el) el.classList.add('active'); })();

  async function ask() {
    const payload = {
      category: document.getElementById('category').value,
      title: document.getElementById('title').value.trim(),
      content: document.getElementById('content').value.trim()
    };
    if (!payload.title || !payload.content) { alert('제목/내용을 입력하세요'); return; }

    document.getElementById('submit').disabled = true;
    document.getElementById('loading').style.display = 'flex';
    try {
      const res = await fetch('/api/ask', {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (!res.ok || !data?.id) { alert(data?.error || '등록 실패'); return; }
      // ✅ /public 제거
      location.href = '/post.html?id=' + data.id;
    } finally {
      document.getElementById('submit').disabled = false;
      document.getElementById('loading').style.display = 'none';
    }
  }
  document.getElementById('submit').addEventListener('click', ask);
</script>
</body>
</html>
